<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Garbanzo</title>
    <meta
      name="description"
      content="Garbanzo is an AI community bot for WhatsApp groups: events, recs, summaries, moderation signals, and owner operations."
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="container">
      <section class="hero">
        <h1 id="title">Garbanzo</h1>
        <p id="tagline"></p>
        <p id="description"></p>
        <div class="actions">
          <a id="ctaPrimary" class="button button-primary" href="#" target="_blank" rel="noreferrer">Support</a>
          <a id="ctaSecondary" class="button button-secondary" href="#" target="_blank" rel="noreferrer">Repository</a>
        </div>
      </section>

      <section class="grid" aria-label="Core strengths">
        <article class="card">
          <h3>Community-first workflows</h3>
          <p>Events, weather, transit, intros, summaries, polls, and owner-ready release broadcasts.</p>
        </article>
        <article class="card">
          <h3>Reliable operations</h3>
          <p>Health and readiness checks, nightly SQLite backups, release automation, and rollback playbooks.</p>
        </article>
        <article class="card">
          <h3>Cost-aware AI routing</h3>
          <p>Configurable provider ordering with local-routing options to balance quality, speed, and spend.</p>
        </article>
      </section>

      <section class="support" id="support">
        <h2>Support Garbanzo</h2>
        <p>If Garbanzo is useful to your community, sponsorship helps fund uptime, development, and support.</p>
        <ul id="supportLinks"></ul>
      </section>

      <section class="tiers" aria-label="Patreon tiers">
        <h2>Patreon Tiers</h2>
        <div class="grid">
          <article class="card">
            <h3>Bean Backer <span class="tier-price">$5/mo</span></h3>
            <p>Monthly project updates and direct support for hosting costs.</p>
          </article>
          <article class="card">
            <h3>Community Operator <span class="tier-price">$15/mo</span></h3>
            <p>Everything in Bean Backer plus roadmap vote influence.</p>
          </article>
          <article class="card">
            <h3>Automation Ally <span class="tier-price">$35/mo</span></h3>
            <p>Everything in Community Operator plus quarterly ops deep dives.</p>
          </article>
          <article class="card">
            <h3>Guild Partner <span class="tier-price">$99/mo</span></h3>
            <p>Everything in Automation Ally plus one monthly async advisory thread.</p>
          </article>
          <article class="card">
            <h3>Commercial Pathfinder <span class="tier-price">$299/mo</span></h3>
            <p>Priority commercial-license intake and faster quote turnaround.</p>
          </article>
        </div>
        <p class="footnote">Patreon support does not grant commercial rights. Commercial usage requires a separate commercial license.</p>
      </section>

      <footer>
        Built for real communities. Deployed via AWS + Docker. Open source with commercial licensing options.
      </footer>
    </main>

    <script>
      async function loadConfig() {
        const response = await fetch('./site-config.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Failed to load site config');
        return response.json();
      }

      function setText(id, value) {
        const el = document.getElementById(id);
        if (el && typeof value === 'string' && value.trim()) el.textContent = value;
      }

      function setLink(id, href, label) {
        const el = document.getElementById(id);
        if (!el) return;
        if (typeof label === 'string' && label.trim()) el.textContent = label;
        if (typeof href === 'string' && href.trim()) {
          el.href = href;
        } else {
          el.style.display = 'none';
        }
      }

      function addSupportLink(list, label, href) {
        if (!href || !href.trim()) return;
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = href;
        a.target = '_blank';
        a.rel = 'noreferrer';
        a.textContent = label;
        li.appendChild(a);
        list.appendChild(li);
      }

      loadConfig()
        .then((cfg) => {
          setText('title', cfg.title);
          setText('tagline', cfg.tagline);
          setText('description', cfg.description);

          setLink('ctaPrimary', cfg.patreonUrl || cfg.githubSponsorsUrl, cfg.ctaPrimaryLabel || 'Support');
          setLink('ctaSecondary', cfg.githubRepoUrl, cfg.ctaSecondaryLabel || 'Repository');

          const list = document.getElementById('supportLinks');
          addSupportLink(list, 'GitHub Sponsors', cfg.githubSponsorsUrl);
          addSupportLink(list, 'Patreon', cfg.patreonUrl);
          addSupportLink(list, 'Ko-fi', cfg.kofiUrl);

          if (!list.children.length) {
            const li = document.createElement('li');
            li.textContent = 'Support links are not configured yet.';
            list.appendChild(li);
          }
        })
        .catch((err) => {
          const list = document.getElementById('supportLinks');
          const li = document.createElement('li');
          li.textContent = `Site config error: ${err instanceof Error ? err.message : String(err)}`;
          list.appendChild(li);
        });
    </script>
  </body>
</html>
